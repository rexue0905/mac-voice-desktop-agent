# iPhone → Mac 远程 Agent 控制系统（学习项目）

## 一、项目目标
构建一个系统，使用户可以通过 iPhone 的语音或文字指令，远程控制 Mac 上运行的桌面 Agent，在受限且可控的范围内完成桌面操作。

系统必须满足以下性质：
- 安全（Security）
- 可控（Controlled）
- 可中断（Interruptible）
- 可追踪（Observable）

iPhone 仅作为输入端；  
Mac 是唯一执行端；  
所有实际操作均发生在 Mac 本机。

---

## 二、总体架构（逻辑链路）

iPhone  
↓  
Receiver（API 接收）  
↓  
Auth（鉴权）  
↓  
Queue（队列 / STOP）  
↓  
Agent（指令解析 / Plan）  
↓  
Skills（白名单能力）  
↓  
Executor（桌面执行 / UI）  
↓  
Logs / Status（日志与状态回执）

### 架构说明
- Receiver：只负责接收请求，不做执行决策
- Agent：将自然语言解析为可执行步骤（Plan）
- Skills：每一个动作都是显式、可审计的能力
- Executor：具体执行桌面操作（如打开应用、浏览器操作、UI 自动化）
- Logs / Status：记录执行过程并提供状态查询

---

## 三、安全红线（强约束，不可违反）

1) 所有请求必须鉴权
- 每次请求必须携带有效 token
- 未通过鉴权的请求不得进入队列

2) 严格白名单
- 仅允许显式定义的 Skills
- 禁止任意 shell / 任意脚本执行

3) 必须可中断（STOP）
- 能中断队列
- 能中断正在执行的任务

4) 禁止敏感自动化
- 不自动输入密码
- 不执行支付/转账
- 不绕过系统安全确认

5) 必须记录日志
- 记录请求、执行步骤、结果
- 不记录 token 等敏感信息

---

## 四、模块化实现规则（开发约束）
- 一次只实现一个模块
- 严格按模块顺序推进
- 不提前实现未来模块
- 不引入复杂框架
- 以稳定、清晰、可维护为优先目标
- 除非明确要求，不进行架构重构或优化

---

## 五、模块规划
X 模块 0：项目初始化与工程护栏
- 模块 1：Mac 接收器（本地 HTTP API）
- 模块 2：鉴权（强 token）
- 模块 3：白名单动作与参数校验
- 模块 4：队列与 STOP 可中断
- 模块 5：最简单执行器（安全动作）
- 模块 6：远程访问（Tailscale）
- 模块 7：iPhone 输入端（快捷指令 / 语音）
- 模块 8：Agent 解析与 Plan（自然语言 → steps）
- 模块 9：UI 自动化 Executor（如 UI-TARS，在安全框架内）

---